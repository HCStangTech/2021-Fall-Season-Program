#pragma config(Motor,  port2,           leftMotor,     tmotorVex393_MC29, openLoop, reversed)
#pragma config(Motor,  port3,           rightMotor,    tmotorVex393_MC29, openLoop, reversed)
#pragma config(Motor,  port4,           magicServo,    tmotorServoStandard, openLoop)
#pragma config(Motor,  port7,           servo,         tmotorServoStandard, openLoop)
#pragma config(Motor,  port8,           scoopMotor,    tmotorVex393_MC29, openLoop)
#pragma config(Motor,  port9,           armMotor,      tmotorVex393_MC29, openLoop)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

bool cancelAuto = false;

void drive(int leftSpeed, int rightSpeed, int time)
{
	int countingTime = 0;
	while(countingTime < time && cancelAuto == false)
	{
		motor[leftMotor] = leftSpeed;
		motor[rightMotor] = rightSpeed;

		if(vexRT[Btn6D])
			cancelAuto = true;

		delay(1);
		countingTime++;
	}
	motor[leftMotor] = 0;
	motor[rightMotor] = 0;
}

void MoveArm(int speed, int time)
{
	int countingTime = 0;
	while(countingTime < time && cancelAuto == false)
	{
		motor[armMotor] = speed;

		if(vexRT[Btn6D])
			cancelAuto = true;

		delay(1);
		countingTime++;
	}
	motor[armMotor] = 0;
}

task main()
{
	int threshold = 10;

	float speedMod = 1;

	motor[servo] = 127;

	bool armLocked = false;

	motor[magicServo] = 50;

	while(true)
	{
		//Movement for the right motor
		if(abs(vexRT[Ch2]) >= threshold)
			motor[rightMotor] = vexRT[Ch2] * speedMod;
		else
			motor[rightMotor] = 0;

		//movement for the left motor
		if(abs(vexRT[Ch3]) >= threshold)
			motor[leftMotor] = vexRT[Ch3] * speedMod;
		else
			motor[leftMotor] = 0;


		//Basic servo movement
		if(vexRT[Btn8U])
			motor[servo] = 127;

		if(vexRT[Btn8D])
			motor[servo] = 0;


		//Movement for arm to go up and down
		if(vexRT[Btn7U])
			motor[armMotor] = 110 * speedMod;
		else if(vexRT[Btn7D])
			motor[armMotor] = -50 * speedMod;
		else if(armLocked)
			motor[armMotor] = 30;
		else
			motor[armMotor] = 0;

		//Motor Locking Control
		if(vexRT[Btn5U])
			armLocked = true;
		if(vexRT[Btn5D])
			armLocked = false;

		//Basic movement for scooper tilting
		if(vexRT[Btn7L])
			motor[scoopMotor] = 50 * speedMod;
		else if(vexRT[Btn7R])
			motor[scoopMotor] = -30 * speedMod;
		else
			motor[scoopMotor] = 0;

		//Autonomous
		if(vexRT[Btn6U])
		{
			cancelAuto = false;
			
			//Raise arm so it dosent catch on the tape
			MoveArm(70, 750);

			//First advance towards the pipe bundle
			drive(80, 85, 1800);

			//Lower arm to touch ground again
			MoveArm(-50, 750);

			//Lock Arm
			motor[armMotor] = 15;

			delay(400);

			//Back it up till we are out of the area
			drive(-70, -75, 3000);

			//Raise the arm to get it out of the way
			MoveArm(70, 675);
			motor[armMotor] = 30;
			
			armLocked = true;
		}

		if(vexRT[Btn5U])
			speedMod = 1;
		if(vexRT[Btn5D])
			speedMod = .75;

		if(vexRT[Btn8R])
			motor[magicServo] = -100;
		if(vexRT[Btn8L])
			motor[magicServo] = 50;


	}

}
